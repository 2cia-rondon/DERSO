<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Solicitação de Derso - 1º BPM</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2>Formulário de Solicitação de Derso - 1º BPM</h2>
        <form id="formulario">
            <div class="form-group">
                <label for="re">RE (Registro Estatístico):</label>
                <input type="text" class="form-control" id="re" name="re" required>
                <small id="reHelp" class="form-text text-muted">O formato deve ser '1000******', com exatamente 10 dígitos.</small>
            </div>

            <div class="form-group">
                <label for="nome_guerra">Nome de Guerra:</label>
                <input type="text" class="form-control" id="nome_guerra" name="nome_guerra" disabled>
            </div>

            <div class="form-group">
                <label for="graduacao">Graduação:</label>
                <input type="text" class="form-control" id="graduacao" name="graduacao" disabled>
            </div>

            <div class="form-group">
                <label for="email">E-mail:</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="data_requerida">Data Requerida:</label>
                <input type="text" class="form-control" id="data_requerida" name="data_requerida" required>
            </div>

            <div class="form-group">
                <label for="folga">Folga:</label>
                <select class="form-control" id="folga" name="folga" required>
                    <option value="">Selecione</option>
                    <option value="24H">Folga 24H</option>
                    <option value="48H">Folga 48H</option>
                    <option value="72H">Folga 72H</option>
                    <option value="1ª FOLGA">1ª FOLGA</option>
                    <option value="2ª FOLGA">2ª FOLGA</option>
                    <option value="Serviço Operacional 1º Turno">Serviço Operacional 1º Turno</option>
                    <option value="Serviço Operacional 2º Turno">Serviço Operacional 2º Turno</option>
                </select>
            </div>

            <!-- Campo para Policiamento só aparecerá quando uma folga for selecionada -->
            <div class="form-group" id="policiamento-container" style="display: none;">
                <label>Policiamento:</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="reforco" name="policiamento" value="reforco">
                    <label class="form-check-label" for="reforco">Reforço</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="rural" name="policiamento" value="rural">
                    <label class="form-check-label" for="rural">Rural</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="tj_cal" name="policiamento" value="tj_cal">
                    <label class="form-check-label" for="tj_cal">TJ CAL</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="emeron_8h" name="policiamento" value="emeron_8h">
                    <label class="form-check-label" for="emeron_8h">Emeron</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="comercio_seguro" name="policiamento" value="comercio_seguro">
                    <label class="form-check-label" for="comercio_seguro">Comércio Seguro</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Enviar</button>
        </form>
    </div>

    <!-- Incluindo o script do Datepicker -->
    <script src="https://cdn.jsdelivr.net/npm/@chenfengyuan/datepicker/dist/datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@chenfengyuan/datepicker/dist/datepicker.min.js"></script>
    <script>
        $(document).ready(function() {
            // Inicializando o plugin de calendário
            $('#data_requerida').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                todayHighlight: true
            });

        // Validando o campo RE e buscando o nome do militar
        document.getElementById('formulario').addEventListener('submit', function(event) {
            event.preventDefault(); // Impede o envio padrão do formulário
            const reInput = document.getElementById('re');
            const reValue = reInput.value.trim();
            const reRegex = /^1000\d{5}$/; // Expressão regular para o formato '1000*****'

            if (!reRegex.test(reValue)) {
                // Se o valor não corresponder ao formato especificado
                alert('O campo RE deve estar no formato 1000*****, com exatamente 10 dígitos.');
                return;
            }

            // Chamada fetch para buscar o RE na planilha
            fetch(`https://script.google.com/macros/s/AKfycbwV35tNwF7hpbMkIBZ9E4sxUx-WydCoHI4sl-oroBsvbCBAa006rA8tHRwPuQRNzUkxJw/exec?re=${reValue}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('RE não encontrado.');
                    } else {
                        // Preenchendo os campos com o nome e a graduação
                        document.getElementById('nome_guerra').value = data.name;
                        document.getElementById('graduacao').value = data.rank;
                    }
                })
                .catch(error => {
                    alert('Erro ao buscar RE: ' + error);
                });
        });
    </script>
</body>
</html>
