<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Solicitação de Derso</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2>Formulário de Solicitação de Derso - 1º BPM</h2>
        <form id="formulario">
            <div class="form-group">
                <label for="re">RE (Registro Estatístico):</label>
                <input type="text" class="form-control" id="re" name="re" required>
                <small id="reHelp" class="form-text text-muted">O formato deve ser '1000*****', com exatamente 09 dígitos.</small>
            </div>
            <div class="form-group">
                <label for="nome_guerra">Nome de Guerra:</label>
                <input type="text" class="form-control" id="nome_guerra" name="nome_guerra" readonly>
            </div>
            <div class="form-group">
                <label for="funcao">Função:</label>
                <input type="text" class="form-control" id="funcao" name="funcao" readonly>
            </div>
            <button type="submit" class="btn btn-primary">Enviar</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        // Substitua com o URL correto do Cloudflare Worker
        const proxyUrl = 'https://proxy-google-script.2cia-rondon.workers.dev/';

        // Adicionando evento de submissão do formulário
        document.getElementById('formulario').addEventListener('submit', function(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            const re = document.getElementById('re').value.trim();

            // Validando o formato do RE
            const reRegex = /^1000\d{5}$/;
            if (!reRegex.test(re)) {
                alert('O RE deve ser no formato "1000*****", com 09 dígitos.');
                return;
            }

            // Fazendo a requisição para o Cloudflare Worker
            fetch(`${proxyUrl}?re=${re}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Preenchendo os campos de nome de guerra e função com os dados retornados
                        document.getElementById('nome_guerra').value = data.nome || 'Não encontrado';
                        document.getElementById('funcao').value = data.funcao || 'Não encontrado';
                    } else {
                        alert('Erro ao buscar RE: ' + (data.error || 'Tente novamente.'));
                    }
                })
                .catch(error => {
                    alert('Erro ao buscar RE. Tente novamente.');
                });
        });
    </script>
</body>
</html>
